# Horse State Tracking Configuration File
# All thresholds and parameters for tuning the state detection system

# Single-Frame Analysis Settings
single_frame:
  # Smoothing window sizes (in frames)
  smoothing_frames_body: 15      # ~0.5 seconds at 30fps
  smoothing_frames_head: 10      # ~0.3 seconds at 30fps
  
  # Minimum confidence thresholds
  min_confidence_threshold: 0.6
  hysteresis_factor: 0.8         # Bias toward previous state (0-1)
  
  # Body State Detection Thresholds
  body_state:
    # Standing/Moving discrimination
    movement_threshold_pixels: 5   # Pixels of movement to detect motion
    hoof_similarity_threshold: 0.1 # Fraction of bbox height for hoof alignment
    
    # Height ratios (fraction of bbox)
    standing_hip_range: [0.4, 0.6]  # Hip height when standing
    lying_hip_threshold: 0.7        # Hip height when lying down
    
    # Lying detection
    lying_aspect_ratio: 1.3          # Width/height ratio for lying position
    
    # Kneeling detection
    kneeling_height_diff: 0.2        # Front/back height difference
    
    # Jumping detection
    jumping_ground_clearance: 0.2    # Bottom fraction of bbox that should be empty
    jumping_leg_angle: 120           # Minimum knee bend angle in degrees
  
  # Head Position Detection Thresholds
  head_position:
    head_angle_threshold: 110        # Degrees from forward for looking back
    head_up_threshold: 0.15          # Fraction of bbox for head elevation
    head_down_threshold: 0.5         # Bottom fraction where head is "down"
    head_lateral_threshold: 0.2      # Fraction of bbox width for left/right

# Multi-Frame Temporal Analysis Settings
temporal_analysis:
  # Window sizes (in frames)
  temporal_window_short: 30         # 1 second at 30fps
  temporal_window_medium: 90        # 3 seconds at 30fps
  temporal_window_long: 150         # 5 seconds at 30fps
  
  # Sliding window update interval
  update_interval: 15                # Update every 0.5 seconds
  
  # Minimum valid frames required (fraction)
  min_valid_frames_ratio: 0.6
  
  # Walking/Running Detection
  gait_detection:
    walking_speed_range: [1.0, 2.0]  # Body lengths per 5 seconds
    running_speed_threshold: 2.0      # Body lengths per 5 seconds
    suspension_phase_frames: 2        # Min frames with all hooves off ground
    gait_rhythm_threshold: 0.7        # FFT regularity score (0-1)
    
  # Pawing Detection
  pawing_detection:
    pawing_frequency_range: [1.0, 3.0]  # Hz (cycles per second)
    pawing_min_cycles: 3                 # Minimum complete cycles
    pawing_amplitude_threshold: 20       # Pixels of vertical movement
    stationary_hoof_threshold: 10        # Max pixels other hooves can move
    
  # Jumping Action Detection
  jumping_action:
    crouch_duration: [0.3, 0.8]      # Seconds in crouch phase
    airborne_duration: [0.2, 0.8]    # Seconds in air
    landing_duration: [0.2, 0.5]     # Seconds in landing phase
    trajectory_fit_threshold: 0.85    # Parabolic fit score (0-1)
    
  # Looking Back Detection
  looking_back:
    hold_duration_min: 1.0            # Seconds head must stay turned
    repeat_pattern_window: 10        # Seconds to detect repeat pattern
    weight_shift_threshold: 0.1      # Fraction of body width

# Confidence Calculation Weights
confidence_weights:
  single_frame:
    keypoint_visibility: 0.4
    geometric_match: 0.4
    smoothing_consistency: 0.2
    
  multi_frame:
    pattern_match: 0.5
    temporal_consistency: 0.3
    keypoint_quality: 0.2

# Visual Display Settings
display:
  # Update frequencies
  state_display_interval: 30         # Frames between display updates
  
  # Colors (BGR format)
  colors:
    upright: [0, 255, 0]             # Green (consolidates standing/moving/walking)
    running: [255, 100, 0]            # Blue
    lying_down: [128, 128, 255]      # Light Red
    kneeling: [200, 128, 255]        # Pink
    jumping: [255, 0, 255]            # Magenta
    
    head_up: [0, 255, 255]           # Yellow
    head_down: [0, 128, 255]         # Orange
    head_left: [128, 255, 128]       # Light Green
    head_right: [255, 128, 255]      # Light Magenta
    head_back: [0, 0, 255]           # Red
    
  # Font settings
  font:
    scale: 0.7
    thickness: 2
    line_type: 2  # cv2.LINE_AA
    
  # Overlay positions (fraction of frame)
  overlay_positions:
    state_bar_height: 0.08
    timeline_height: 0.05
    alert_box_size: [0.2, 0.1]

# Performance Settings
performance:
  max_horses_tracked: 10
  enable_gpu: true
  batch_size: 4
  num_threads: 4
  
# Logging Settings
logging:
  log_level: "INFO"
  save_timeline_data: true
  timeline_output_format: "json"  # json or csv
  save_confidence_scores: true
  save_raw_measurements: false

# Alert Settings
alerts:
  # Concerning state combinations to highlight
  concerning_patterns:
    - ["LYING_DOWN", "HEAD_BACK"]     # Possible colic
    - ["PAWING_GROUND", "HEAD_BACK"]  # Discomfort
    - ["ROLLING", "REPEATED"]          # Severe colic sign
  
  alert_duration: 5.0                 # Seconds to show alert
  alert_cooldown: 30.0                # Seconds before same alert can trigger again